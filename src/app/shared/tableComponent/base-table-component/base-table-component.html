<!-- Loading Indicator -->
@if (loading) {
<div class="mb-4 text-center text-blue-600 font-medium">Loading...</div>
}

<div class="base-table space-y-6">
  <!-- Table Heading -->
  <div class="text-2xl font-bold text-gray-800 text-center md:text-left mb-4">
    {{ tableTitle }}
  </div>

  <div class="base-table space-y-6">
    <!-- Filter Section -->
    <div class="filter-section flex flex-col md:flex-row items-center justify-around gap-4 mb-6">
      <div class="flex w-1/2 gap-4">
        <mat-form-field class="flex-1">
          <mat-label>Filter by</mat-label>
          <mat-select [(value)]="selectedFilterField">
            <mat-option *ngFor="let col of filterableColumns" [value]="col.field.toString()">
              {{ col.header }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field class="flex-1">
          <mat-label>Search <mat-icon>search</mat-icon></mat-label>
          <input
            matInput
            placeholder="Enter search text"
            (input)="applyFilter(selectedFilterField, $event)"
          />
        </mat-form-field>
      </div>
    </div>

    <!-- Table -->
    <div class="overflow-x-auto rounded-lg border border-gray-500 shadow-sm mb-6">
      <table
        mat-table
        [dataSource]="dataSource"
        matSort
        (matSortChange)="onSortChange($event)"
        class="min-w-full divide-y divide-gray-200"
      >
        <!-- Dynamic Columns -->
        @for (col of columns; track col.field) {
        <ng-container [matColumnDef]="col.field.toString()">
          <th
            mat-header-cell
            *matHeaderCellDef
            mat-sort-header
            class="px-4 py-2 bg-gray-100 text-left text-sm font-semibold text-gray-700 uppercase tracking-wider border-b border-gray-300"
          >
            {{ col.header }}
          </th>
          <td mat-cell *matCellDef="let row" class="px-4 py-2 text-sm text-gray-600">
            @if (!col.type || col.type === 'text') {
            {{ getCellValue(row, col.field) }}
            } @if (col.type === 'custom') {
            <ng-container
              *ngTemplateOutlet="getTemplate(col.field.toString()); context: { $implicit: row }"
            ></ng-container>
            } @if (col.type === 'action') {
            <div class="flex space-x-2">
              <button
                mat-icon-button
                color="primary"
                (click)="actionClicked.emit({ action: 'view', row: row })"
                aria-label="View"
              >
                <mat-icon>visibility</mat-icon>
              </button>
              <button
                mat-icon-button
                color="accent"
                (click)="actionClicked.emit({ action: 'edit', row: row })"
                aria-label="Edit"
              >
                <mat-icon>edit</mat-icon>
              </button>
              <button
                mat-icon-button
                color="warn"
                (click)="actionClicked.emit({ action: 'delete', row: row })"
                aria-label="Delete"
              >
                <mat-icon>delete</mat-icon>
              </button>
            </div>
            }
          </td>
        </ng-container>
        }

        <!-- Header & Rows -->
        <tr
          mat-header-row
          *matHeaderRowDef="displayedColumns"
          class="border-b border-gray-300"
        ></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns" class="hover:bg-gray-50"></tr>
      </table>
    </div>

    <!-- Pagination -->
    <div class="w-full">
      <mat-paginator
        [length]="total"
        [pageSize]="pageSize"
        [pageIndex]="page - 1"
        [pageSizeOptions]="[5, 10, 25, 50]"
        (page)="onPageChange($event)"
        class="shadow rounded-md"
      >
      </mat-paginator>
    </div>
  </div>
</div>
