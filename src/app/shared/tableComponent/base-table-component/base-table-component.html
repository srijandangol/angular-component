@if (loading) {
<div class="mb-4 text-center text-blue-600 font-medium">Loading...</div>
}

<div class="base-table space-y-6">
  <div class="flex justify-end mb-4">
    <div class="flex gap-2">
      @if (hasActiveFilters()) {
      <button mat-stroked-button color="warn" (click)="clearFilters()">
        <mat-icon>clear</mat-icon> Clear Filters
      </button>
      }
      <button mat-raised-button color="primary" (click)="openFilterDialog()">
        <mat-icon>filter_list</mat-icon> Filter
      </button>
    </div>
  </div>

  <div class="overflow-x-auto rounded-lg border border-gray-500 shadow-sm mb-6">
    <table mat-table [dataSource]="dataSource" matSort (matSortChange)="onSortChange($event)"
      class="min-w-full divide-y divide-gray-200">
      @for (col of columns; track col.field) {
      <ng-container [matColumnDef]="col.field.toString()">
        <th mat-header-cell *matHeaderCellDef mat-sort-header
          class="px-4 py-2 bg-gray-100 text-left text-sm font-semibold text-gray-700 uppercase tracking-wider border-b border-gray-300">
          {{ col.header }}
        </th>
        <td mat-cell *matCellDef="let row" class="px-4 py-2 text-sm text-gray-600">
          @if (!col.type || col.type === 'text') {
          {{ getCellValue(row, col.field) }}
          } @if (col.type === 'custom') {
          <ng-container
            *ngTemplateOutlet="getTemplate(col.field.toString()); context: { $implicit: row }"></ng-container>
          } @if (col.type === 'action') {
          <div class="flex space-x-2">
            <button mat-icon-button color="primary" (click)="actionClicked.emit({ action: 'view', row: row })"
              aria-label="View">
              <mat-icon>visibility</mat-icon>
            </button>
            <button mat-icon-button color="accent" (click)="actionClicked.emit({ action: 'edit', row: row })"
              aria-label="Edit">
              <mat-icon>edit</mat-icon>
            </button>
            <button mat-icon-button color="warn" (click)="actionClicked.emit({ action: 'delete', row: row })"
              aria-label="Delete">
              <mat-icon>delete</mat-icon>
            </button>
          </div>
          }
        </td>
      </ng-container>
      }

      <tr mat-header-row *matHeaderRowDef="displayedColumns" class="border-b border-gray-300"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns" class="hover:bg-gray-50"></tr>
    </table>
  </div>

  <div class="w-full">
    <mat-paginator [length]="total" [pageSize]="pageSize" [pageIndex]="page - 1" [pageSizeOptions]="[5, 10, 25, 50]"
      (page)="onPageChange($event)" class="shadow rounded-md">
    </mat-paginator>
  </div>
</div>