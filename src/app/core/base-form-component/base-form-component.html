<form [formGroup]="form" (ngSubmit)="onSubmit()" class="flex flex-col gap-4">

  <div *ngFor="let field of config" class="w-full">

    <!-- Only for inputs/selects/textarea -->
    <mat-form-field *ngIf="field.type !== 'file'" appearance="fill" class="w-full">
      <mat-label>{{ field.label }}</mat-label>

      <ng-container [ngSwitch]="field.type">
        <input *ngSwitchCase="'input'" matInput [formControlName]="field.name" />
        <textarea *ngSwitchCase="'textarea'" matInput [formControlName]="field.name"></textarea>
        <mat-select *ngSwitchCase="'select'" [formControlName]="field.name">
          <mat-option *ngFor="let option of field.options" [value]="option.value">
            {{ option.label }}
          </mat-option>
        </mat-select>
      </ng-container>

      <mat-error *ngIf="form.get(field.name)?.hasError('required')">
        {{ field.label }} is required
      </mat-error>
    </mat-form-field>

  <!-- File upload (PNG < 3MB) -->
<div *ngIf="field.type === 'file'" class="flex flex-col gap-2">
  <label class="font-medium">{{ field.label }}</label>

  <!-- Hidden file input -->
  <input
    #fileInput
    type="file"
    [accept]="field.accept || '.png'"
    (change)="onFileChange($event, field)"
    hidden
  />

  <!-- Button to trigger file input -->
  <button mat-raised-button color="primary" type="button" (click)="fileInput.click()">
    Choose File
  </button>

  <small class="text-gray-500">
    Only PNG files below {{ field.maxSizeMB || 3 }} MB allowed
  </small>

  <mat-error *ngIf="fileError">{{ fileError }}</mat-error>

  <!-- Optional preview -->
  <img
    *ngIf="previewUrl"
    [src]="previewUrl"
    alt="Preview"
    class="w-32 h-32 object-cover mt-2 border rounded-md"
  />
</div>
  </div>

 <button
  type="submit"
  [disabled]="form.invalid"
  class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded shadow disabled:opacity-50 disabled:cursor-not-allowed transition"
>
  Submit
</button>

